@model dynamic
@{
    ViewBag.Title = "Index";
}


<div id="shower"></div>

<h2>Index</h2>

@section scripts{

     <!--Script references. -->
<!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
<!--Reference the SignalR library. -->
<script src="~/Scripts/jquery.signalR-2.2.0.min.js"></script>
<!--Reference the autogenerated SignalR hub script. -->
<script src="~/signalr/hubs"></script>
<!--SignalR script to update the chat page and send messages.-->
<script>
        $(function () {
            // Reference the auto-generated proxy for the hub.
            var hub = $.connection.buyer;
        
            function init() {
                var groupname = Math.random();


                return hub.server.getNeastBuyerInfo(groupname + "组").done(function (buyers) {


                    //从BuyerHub获取buyer数组，就是这里的参数
                    //遍历显示，如果现在列表中不包含，则插入到第一条
                    var div = $("#shower");
                    $.each(buyers, function (index, item) {

                        div.prepend("昵称：" + item.Nick + "ID:" + item.BuyerUid + "所属组别：" + item.GoupName);
                    });
                });
            }
            $.extend(hub.client, {
                          updateInfo: function () {//为client创建一个方法updateInfo一会会用到
                              return init();
                          }
                  });
            $.connection.hub.start().pipe(init);//开启客户端SignalR，并首次运行init
        });


</script>
}